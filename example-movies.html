<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">

    <!-- Basic -->
    <title>Movies Example | Vulcan Docs</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="shortcut icon" type="image/png" href="images/favicon.ico" sizes="16x16 32x32 64x64">

    <!-- Social -->
    <meta property="og:type" content="article">
    <meta property="og:url" content="http://docs.vulcanjs.org">
    <meta property="og:title" content="Movies Example | Vulcan Docs">
    <meta property="og:description" content="">
    <meta property="og:image" content="">
    <meta name="twitter:card" content="summary_image_large">
    <meta name="twitter:site" content="@telescopeapp">
    <meta name="twitter:title" content="Movies Example | Vulcan Docs">
    <meta name="twitter:description" content="">
    <meta name="twitter:image" content="">

    <!-- Misc -->
    <meta name="google-site-verification" content="" />
    <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,300,200,300italic,400italic' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="/style/style.css">
  </head>
  <body class="">
    

<div class="nav dark">
  <div class="nav-group">
    <div class="nav-item show-mobile">
      <span class="js-sidebar-toggle ">
        <span class="icon-menu"></span>
      </span>
    </div>
    <div class="nav-item">
      <a class="logo-wrapper" href="http://docs.vulcanjs.org/" title="Vulcan Documentation Vulcan Documentation"  >
        <img src="/images/vulcan-logo-border-2.svg" alt="Vulcan Documentation" class="logo"/>
        <span>Vulcan Documentation</span>
      </a>
    </div>
  </div>

  <div class="nav-group right">
    
      
      <div class="nav-item show-desktop false ">
        <a class="link" href="https://github.com/vulcanjs/vulcan"  >
          <span>GitHub</span>
        </a>
      </div>
    
      
      <div class="nav-item show-desktop false ">
        <a class="link" href="http://slack.telescopeapp.org"  >
          <span>Slack</span>
        </a>
      </div>
    
  </div>
</div>

<div class="sidebar">
  <div class="panel">
    <div class="panel-item">
      <a class="" href="http://docs.vulcanjs.org/" title="Vulcan Documentation"  >
        <span>Vulcan Documentation Vulcan Documentation</span>
      </a>
    </div>
    
      <div class="panel-item "">
        <a class="" href="https://github.com/vulcanjs/vulcan"  >
          <span>GitHub</span>
        </a>
      </div>
    
      <div class="panel-item "">
        <a class="" href="http://slack.telescopeapp.org"  >
          <span>Slack</span>
        </a>
      </div>
    
  </div>

  <div class="sidebar-content">
    <div class="topcap">
      
    </div>

    

    <ul class="toc">
      
        <li>
          
          <ul class="list-toc">
            
              
              <li class="item-toc ">
                <a href="index.html" class="sidebar-link ">
                  <span>Introduction</span>
                </a>
              </li>
            
          </ul>
        </li>
      
        <li>
          
            <div class="heading-toc">Overview</div>
          
          <ul class="list-toc">
            
              
              <li class="item-toc ">
                <a href="features.html" class="sidebar-link ">
                  <span>Features</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="architecture.html" class="sidebar-link ">
                  <span>Architecture</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="vulcan.html" class="sidebar-link ">
                  <span>From Telescope to Vulcan</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="packages.html" class="sidebar-link ">
                  <span>Packages</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="common-problems.html" class="sidebar-link ">
                  <span>Common Problems</span>
                </a>
              </li>
            
          </ul>
        </li>
      
        <li>
          
            <div class="heading-toc">Data Layer</div>
          
          <ul class="list-toc">
            
              
              <li class="item-toc ">
                <a href="schemas.html" class="sidebar-link ">
                  <span>Collections & Schemas</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="data-loading.html" class="sidebar-link ">
                  <span>Data Loading</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="fragments.html" class="sidebar-link ">
                  <span>Fragments</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="terms-parameters.html" class="sidebar-link ">
                  <span>Terms & Parameters</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="mutations.html" class="sidebar-link ">
                  <span>Mutations</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="redux.html" class="sidebar-link ">
                  <span>Using Redux</span>
                </a>
              </li>
            
          </ul>
        </li>
      
        <li>
          
            <div class="heading-toc">API</div>
          
          <ul class="list-toc">
            
              
              <li class="item-toc ">
                <a href="theming.html" class="sidebar-link ">
                  <span>Components & Theming</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="core-components.html" class="sidebar-link ">
                  <span>Core Components</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="callbacks.html" class="sidebar-link ">
                  <span>Callbacks</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="users.html" class="sidebar-link ">
                  <span>Users</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="groups-permissions.html" class="sidebar-link ">
                  <span>Groups & Permissions</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="routing.html" class="sidebar-link ">
                  <span>Routing</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="internationalization.html" class="sidebar-link ">
                  <span>Internationalization</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="head-tags.html" class="sidebar-link ">
                  <span>Head Tags</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="settings.html" class="sidebar-link ">
                  <span>Settings</span>
                </a>
              </li>
            
          </ul>
        </li>
      
        <li>
          
            <div class="heading-toc">Forms</div>
          
          <ul class="list-toc">
            
              
              <li class="item-toc ">
                <a href="forms.html" class="sidebar-link ">
                  <span>Forms</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="forms-custom.html" class="sidebar-link ">
                  <span>Custom Form Components</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="forms-upload.html" class="sidebar-link ">
                  <span>Upload Package</span>
                </a>
              </li>
            
          </ul>
        </li>
      
        <li>
          
            <div class="heading-toc">Packages</div>
          
          <ul class="list-toc">
            
              
              <li class="item-toc ">
                <a href="email.html" class="sidebar-link ">
                  <span>Email</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="newsletter.html" class="sidebar-link ">
                  <span>Newsletter</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="payments.html" class="sidebar-link ">
                  <span>Payments</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="admin.html" class="sidebar-link ">
                  <span>Admin Dashboard</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="embed.html" class="sidebar-link ">
                  <span>Embed</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="cloudinary.html" class="sidebar-link ">
                  <span>Cloudinary</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="voting.html" class="sidebar-link ">
                  <span>Voting</span>
                </a>
              </li>
            
          </ul>
        </li>
      
        <li>
          
            <div class="heading-toc">Tutorials</div>
          
          <ul class="list-toc">
            
              
              <li class="item-toc ">
                <a href="example-simple.html" class="sidebar-link ">
                  <span>Simple Example</span>
                </a>
              </li>
            
              
              <li class="item-toc  current">
                <a href="" class="sidebar-link  current">
                  <span>Movies Example</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="example-instagram.html" class="sidebar-link ">
                  <span>Instagram Example</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="example-forum.html" class="sidebar-link ">
                  <span>Forum Example</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="example-customization.html" class="sidebar-link ">
                  <span>Customization Example</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="example-permissions.html" class="sidebar-link ">
                  <span>Permissions Example</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="sponsorship-tutorial.html" class="sidebar-link ">
                  <span>Sponsorship Flow Tutorial</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="deployment.html" class="sidebar-link ">
                  <span>Deployment Guide</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="migration.html" class="sidebar-link ">
                  <span>Migration Guide</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="recipes.html" class="sidebar-link ">
                  <span>Recipes</span>
                </a>
              </li>
            
          </ul>
        </li>
      
        <li>
          
            <div class="heading-toc">Resources</div>
          
          <ul class="list-toc">
            
              
              <li class="item-toc ">
                <a href="learn.html" class="sidebar-link ">
                  <span>Learn More</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="examples.html" class="sidebar-link ">
                  <span>Examples</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="plugins.html" class="sidebar-link ">
                  <span>Plugins</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="themes.html" class="sidebar-link ">
                  <span>Themes</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="tutorials.html" class="sidebar-link ">
                  <span>Tutorials</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="videos.html" class="sidebar-link ">
                  <span>Videos</span>
                </a>
              </li>
            
          </ul>
        </li>
      
    </ul>
  </div>
</div>

<div class="content">
  <div class="content-wrapper">
    <div class="header-content">
      <h1 class="title-page">Movies Example</h1>
      

      <div class="page-actions">
        <div class="actions-group">
          <a class="btn tertiary small round lowercase" href="https://github.com/vulcanjs/nova-docs/tree/master/source/example-movies.md" target="_blank"><span class="icon-github"></span> <span>Edit on GitHub</span></a>
          
        </div>
      </div>
    </div>

    <div class="document-formatting">
      <p>Out of the box, Vulcan comes with many features such as handling posts and comments, generating a newsletter, and much more. </p>
<p>But it’s important to understand that you can also use the underlying framework powering these features directly and build a completely different type of app. </p>
<p>So in this tutorial, we’ll focus on understanding this framework and seeing how to build a simple paginated list of movies. </p>
<p>The completed code for this tutorial can be found in <a href="https://github.com/TelescopeJS/Telescope/tree/master/packages/example-movies" target="_blank" rel="external">the <code>example-movies</code> package</a>.</p>
<h2 id="Video-Tutorial"><a href="#Video-Tutorial" class="headerlink" title="Video Tutorial"></a>Video Tutorial</h2><iframe width="560" height="315" src="https://www.youtube.com/embed/4HidaFce6j0" frameborder="0" allowfullscreen></iframe>

<p>Note: this video differs slightly from the following tutorial when it comes to <a href="#The-User-Resolver">defining the <code>user</code> resolver on the <code>userId</code> field</a>. Both approaches will work, but make sure you check the tutorial to get the most up-to-date syntax. </p>
<h2 id="Short-amp-Long-Versions"><a href="#Short-amp-Long-Versions" class="headerlink" title="Short &amp; Long Versions"></a>Short &amp; Long Versions</h2><p>This tutorial includes a shorter version that uses some of Vulcan’s default presets to save you time. If you’d rather to this short version, just skip every section marked with a <code>*</code> sign.</p>
<h2 id="Set-Up"><a href="#Set-Up" class="headerlink" title="Set Up"></a>Set Up</h2><p>First, make sure you’re only including the packages you need. This means everything in your <code>.meteor/packages</code> file should be commented out except for the core packages, a language package, and an accounts package.</p>
<p>Here’s a quick overview of the main packages:</p>
<ul>
<li><code>vulcan:core</code>: Vulcan’s core libraries. </li>
<li><code>vulcan:forms</code>: the library used for generating and submitting forms. </li>
<li><code>vulcan:routing</code>: sets up and initializes routing and server-side rendering.</li>
<li><code>vulcan:users</code>: user management (groups, permissions, etc.).</li>
</ul>
<p>We’ll also keep <code>vulcan:i18n-en-us</code>, since it contains strings for core UI features, as well as Meteor’s <code>accounts-password</code> package to activate password log in.</p>
<h2 id="Creating-a-Package"><a href="#Creating-a-Package" class="headerlink" title="Creating a Package"></a>Creating a Package</h2><p>The next step will be creating a Meteor package to hold our code. This will be a <em>local</em> package, meaning it will live inside your repo, but we’ll still have all the advantages of regular, remote packages (easy to enable/disable, restricted scope, ability to specify dependencies, etc.).</p>
<p>Create a new <code>my-package</code> directory under <code>/packages</code>. We’ll use the following file structure:</p>
<figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">my-package</span><br><span class="line">  <span class="class"><span class="keyword">lib</span></span></span><br><span class="line">    client</span><br><span class="line">      - main.js</span><br><span class="line">    components</span><br><span class="line">      movies</span><br><span class="line">    modules</span><br><span class="line">      movies</span><br><span class="line">      - index.js</span><br><span class="line">    server</span><br><span class="line">      - main.js</span><br><span class="line">    stylesheets</span><br><span class="line">  - package.js</span><br></pre></td></tr></table></figure>
<ul>
<li><code>package.js</code> is your <a href="http://docs.meteor.com/api/packagejs.html" target="_blank" rel="external">package manifest</a>, and it tells Meteor which files to load.</li>
<li><code>client/main.js</code> and <code>server/main.js</code> are the client and server entry points.</li>
<li><code>modules/index.js</code> lists all the various modules that make up our package. </li>
<li><code>style.css</code> contains all our styles.</li>
</ul>
<p>Set up all the directories along with the blank files within. Once this is done, let’s start with the <code>package.js</code> file:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">Package.describe(&#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">'my-package'</span>,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">Package.onUse(<span class="function"><span class="keyword">function</span> (<span class="params">api</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  api.use([</span><br><span class="line">    <span class="string">'vulcan:core'</span>,</span><br><span class="line">    <span class="string">'vulcan:forms'</span>,</span><br><span class="line">    <span class="string">'vulcan:accounts'</span>,</span><br><span class="line">  ]);</span><br><span class="line"></span><br><span class="line">  api.addFiles(<span class="string">'lib/stylesheets/bootstrap.min.css'</span>, <span class="string">'client'</span>);</span><br><span class="line"></span><br><span class="line">  api.mainModule(<span class="string">'lib/server/main.js'</span>, <span class="string">'server'</span>);</span><br><span class="line">  api.mainModule(<span class="string">'lib/client/main.js'</span>, <span class="string">'client'</span>);</span><br><span class="line"></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>The <code>api.use</code> block defines our package’s dependencies: <code>vulcan:core</code>, <code>vulcan:forms</code>, and <code>vulcan:accounts</code>, a package that provides a set of React components for managing log in and sign up. </p>
<p>We then define our two client and server endpoints using <code>api.mainModule</code>. Create <code>lib/client/main.js</code> and <code>lib/server/main.js</code>, and paste in the following line in both:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">'../modules/index.js'</span>;</span><br></pre></td></tr></table></figure>
<p>Finally, let’s include the <a href="http://getbootstrap.com" target="_blank" rel="external">Bootstrap</a> stylesheet in <code>lib/stylesheets/bootstrap.min.css</code> to make our app look a little better. You can get it from <a href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.4/css/bootstrap.min.css" target="_blank" rel="external">here</a>.</p>
<p>The last step to activate your package is enabling it using the <code>meteor add</code> command to add it to your <code>.meteor/packages</code> file:</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">meteor <span class="keyword">add</span><span class="bash"> my-package</span></span><br></pre></td></tr></table></figure>
<p>It may seem like not much happened, but once Meteor restart our custom package will now be active and loaded. </p>
<h2 id="Our-First-Component"><a href="#Our-First-Component" class="headerlink" title="Our First Component"></a>Our First Component</h2><p>We now have the basic structure of our package, so let’s get to work. We’ll create a new component and a new route to display it. </p>
<p>First, create a new <code>components</code> directory inside <code>lib</code> if you haven’t done so yet and add the <code>movies</code> directory. Inside <code>components/movies</code> add a new file containing a <code>MoviesList</code> component:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">import React, &#123; PropTypes, Component &#125; from 'react';</span><br><span class="line">import &#123; Components, withList, withCurrentUser, Loading &#125; from 'meteor/vulcan:core';</span><br><span class="line"></span><br><span class="line">const MoviesList = (&#123;results = [], currentUser, loading, loadMore, count, totalCount&#125;) =&gt; </span><br><span class="line">  </span><br><span class="line">  &lt;div style=&#123; &#123; maxWidth: '500px', margin: '20px auto' &#125; &#125;&gt;</span><br><span class="line"></span><br><span class="line">    Hello World!</span><br><span class="line"></span><br><span class="line">    &#123;/* user accounts placeholder */&#125;</span><br><span class="line"></span><br><span class="line">      &lt;div className="movies"&gt;</span><br><span class="line">        </span><br><span class="line">        &#123;/* new document form placeholder */&#125;</span><br><span class="line">        </span><br><span class="line">        &#123;/* documents list placeholder */&#125;</span><br><span class="line">        </span><br><span class="line">        &#123;/* load more placeholder */&#125;</span><br><span class="line"></span><br><span class="line">      &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">  &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">export default MoviesList;</span><br></pre></td></tr></table></figure>
<h2 id="Routing"><a href="#Routing" class="headerlink" title="Routing"></a>Routing</h2><p>We can now create a <a href="/routing.html">route</a> to display this component. Create a new <code>routes.js</code> file inside <code>modules</code>:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; addRoute &#125; <span class="keyword">from</span> <span class="string">'meteor/vulcan:core'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> MoviesList <span class="keyword">from</span> <span class="string">'../components/movies/MoviesList.jsx'</span>;</span><br><span class="line"></span><br><span class="line">addRoute(&#123; <span class="attr">name</span>: <span class="string">'movies'</span>, <span class="attr">path</span>: <span class="string">'/'</span>, <span class="attr">component</span>: MoviesList &#125;);</span><br></pre></td></tr></table></figure>
<p>In case you’re wondering, <code>addRoute</code> is a very thin wrapper over <a href="https://github.com/ReactTraining/react-router" target="_blank" rel="external">React Router</a>. </p>
<p>Make sure to also import <code>routes.js</code> inside <code>modules/index.js</code>:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">'./routes.js'</span>;</span><br></pre></td></tr></table></figure>
<p>If everything worked properly, you should now be able to head to <code>http://localhost:3000/</code> and see your <code>MoviesList</code> component show up. </p>
<h2 id="The-Schema"><a href="#The-Schema" class="headerlink" title="The Schema"></a>The Schema</h2><p>We want to display a list of movies, which means querying for data as well as setting up basic insert, edit, and remove operations. But before we can do any of that, we need to define what a “movie” is. In other words, we need a schema. </p>
<p>Vulcan uses JSON schemas based on the <a href="https://github.com/aldeed/meteor-simple-schema" target="_blank" rel="external">SimpleSchema</a> package. You can also check out the <a href="/schemas.html">Collections &amp; Schemas</a> section if you want to learn more. </p>
<p>Create <code>schema.js</code> inside <code>modules/movies</code>:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> schema = &#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// default properties</span></span><br><span class="line"></span><br><span class="line">  _id: &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="built_in">String</span>,</span><br><span class="line">    <span class="attr">optional</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">viewableBy</span>: [<span class="string">'guests'</span>],</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">createdAt</span>: &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="built_in">Date</span>,</span><br><span class="line">    <span class="attr">optional</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">viewableBy</span>: [<span class="string">'guests'</span>],</span><br><span class="line">    <span class="attr">onInsert</span>: <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">userId</span>: &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="built_in">String</span>,</span><br><span class="line">    <span class="attr">optional</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">viewableBy</span>: [<span class="string">'guests'</span>],</span><br><span class="line">  &#125;,</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// custom properties</span></span><br><span class="line"></span><br><span class="line">  name: &#123;</span><br><span class="line">    <span class="attr">label</span>: <span class="string">'Name'</span>,</span><br><span class="line">    <span class="attr">type</span>: <span class="built_in">String</span>,</span><br><span class="line">    <span class="attr">optional</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">viewableBy</span>: [<span class="string">'guests'</span>],</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">year</span>: &#123;</span><br><span class="line">    <span class="attr">label</span>: <span class="string">'Year'</span>,</span><br><span class="line">    <span class="attr">type</span>: <span class="built_in">String</span>,</span><br><span class="line">    <span class="attr">optional</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">viewableBy</span>: [<span class="string">'guests'</span>],</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">review</span>: &#123;</span><br><span class="line">    <span class="attr">label</span>: <span class="string">'Review'</span>,</span><br><span class="line">    <span class="attr">type</span>: <span class="built_in">String</span>,</span><br><span class="line">    <span class="attr">optional</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">viewableBy</span>: [<span class="string">'guests'</span>],</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> schema;</span><br></pre></td></tr></table></figure>
<p>Note that we’re setting up an <code>onInsert</code> function on the <code>createdAt</code> field to initialize it to the current timestamp whenever a new document is inserted. </p>
<p>And we’re also setting <code>viewableBy: [&#39;guests&#39;]</code> on every field to make sure they’re visible to non-logged-in users (who belong to the default <code>guests</code> group). By default, any schema field is kept private, so we need to make sure we don’t forget this step if we want our data to be publicly accessible.</p>
<h2 id="Setting-Up-a-Collection"><a href="#Setting-Up-a-Collection" class="headerlink" title="Setting Up a Collection"></a>Setting Up a Collection</h2><p>We’re now ready to set up our <code>Movies</code> collection. Create a new <code>collection.js</code> file inside <code>modules/movies</code>:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createCollection &#125; <span class="keyword">from</span> <span class="string">'meteor/vulcan:core'</span>;</span><br><span class="line"><span class="keyword">import</span> schema <span class="keyword">from</span> <span class="string">'./schema.js'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Movies = createCollection(&#123;</span><br><span class="line"></span><br><span class="line">  <span class="attr">collectionName</span>: <span class="string">'Movies'</span>,</span><br><span class="line"></span><br><span class="line">  <span class="attr">typeName</span>: <span class="string">'Movie'</span>,</span><br><span class="line"></span><br><span class="line">  schema,</span><br><span class="line"></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Movies;</span><br></pre></td></tr></table></figure>
<p><code>createCollection</code> takes in a collection name, type name (in other words, the GraphQL type of documents belonging to this collection), a schema (as well as a few other objecs we’ll learn about later) and sets up a fully working GraphQL data layer for you!</p>
<p>As we did previously with <code>routes.js</code>, import <code>collection.js</code> from <code>index.js</code>:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// The Movies collection</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">'./movies/collection.js'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Routes</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">'./routes.js'</span>;</span><br></pre></td></tr></table></figure>
<p>At this point it might not look like much has changed, but we now have a functional GraphQL schema! You can see it by opening up the Meteor shell in a terminal window (by typing <code>meteor shell</code> from within your app directory) and typing:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;GraphQLSchema&#125; <span class="keyword">from</span> <span class="string">'meteor/vulcan:lib'</span></span><br><span class="line">GraphQLSchema.finalSchema</span><br></pre></td></tr></table></figure>
<p>But even though we have a schema, we can’t actually query for a document yet because we don’t have any <strong>query resolvers</strong>. </p>
<h2 id="Note-Default-Resolvers-amp-Mutations"><a href="#Note-Default-Resolvers-amp-Mutations" class="headerlink" title="Note: Default Resolvers &amp; Mutations"></a>Note: Default Resolvers &amp; Mutations</h2><p>Vulcan provides a set of <a href="/data-loading.html#Default-Resolvers">default resolvers</a> to speed things up, but for the sake of learning how things work this tutorial will show you how to write resolvers yourself. </p>
<p>If you’d rather skip this and use the defaults for now, just use the following code in <code>collection.js</code>, and simply ignore any section concerning the <code>resolvers.js</code> or <code>mutations.js</code> files (they will be marked with a <code>*</code> sign):</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createCollection, getDefaultResolvers, getDefaultMutations &#125; <span class="keyword">from</span> <span class="string">'meteor/vulcan:core'</span>;</span><br><span class="line"><span class="keyword">import</span> schema <span class="keyword">from</span> <span class="string">'./schema.js'</span>;</span><br><span class="line"><span class="keyword">import</span> resolvers <span class="keyword">from</span> <span class="string">'./resolvers.js'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'./fragments.js'</span>;</span><br><span class="line"><span class="keyword">import</span> mutations <span class="keyword">from</span> <span class="string">'./mutations.js'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'./permissions.js'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'./parameters.js'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Movies = createCollection(&#123;</span><br><span class="line"></span><br><span class="line">  <span class="attr">collectionName</span>: <span class="string">'Movies'</span>,</span><br><span class="line"></span><br><span class="line">  <span class="attr">typeName</span>: <span class="string">'Movie'</span>,</span><br><span class="line"></span><br><span class="line">  schema,</span><br><span class="line">  </span><br><span class="line">  <span class="attr">resolvers</span>: getDefaultResolvers(<span class="string">'Movies'</span>),</span><br><span class="line"></span><br><span class="line">  <span class="attr">mutations</span>: getDefaultMutations(<span class="string">'Movies'</span>),</span><br><span class="line"></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Movies;</span><br></pre></td></tr></table></figure>
<h2 id="Custom-Query-Resolvers"><a href="#Custom-Query-Resolvers" class="headerlink" title="Custom Query Resolvers*"></a>Custom Query Resolvers*</h2><p><em>(Note: you can skip this section if you’re using default resolvers and mutations)</em></p>
<p>In a nutshell, a resolver tells the server how to respond to a specific GraphQL query, and you can learn more about them in the <a href="/data-loading.html">Data Loading</a> section. </p>
<p>Let’s start simple. Create a new <code>resolvers.js</code> file inside <code>modules/movies</code> and add:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> resolvers = &#123;</span><br><span class="line"></span><br><span class="line">  <span class="attr">list</span>: &#123;</span><br><span class="line"></span><br><span class="line">    <span class="attr">name</span>: <span class="string">'moviesList'</span>,</span><br><span class="line"></span><br><span class="line">    resolver(root, args, context) &#123;</span><br><span class="line">      <span class="keyword">return</span> context.Movies.find().fetch();</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> resolvers;</span><br></pre></td></tr></table></figure>
<p>Then import this new file from <code>collection.js</code>:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createCollection &#125; <span class="keyword">from</span> <span class="string">'meteor/vulcan:core'</span>;</span><br><span class="line"><span class="keyword">import</span> schema <span class="keyword">from</span> <span class="string">'./schema.js'</span>;</span><br><span class="line"><span class="keyword">import</span> resolvers <span class="keyword">from</span> <span class="string">'./resolvers.js'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Movies = createCollection(&#123;</span><br><span class="line"></span><br><span class="line">  <span class="attr">collectionName</span>: <span class="string">'Movies'</span>,</span><br><span class="line"></span><br><span class="line">  <span class="attr">typeName</span>: <span class="string">'Movie'</span>,</span><br><span class="line"></span><br><span class="line">  schema,</span><br><span class="line">  </span><br><span class="line">  resolvers,</span><br><span class="line"></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Movies;</span><br></pre></td></tr></table></figure>
<h2 id="Seeding-The-Database"><a href="#Seeding-The-Database" class="headerlink" title="Seeding The Database"></a>Seeding The Database</h2><p>We can try out our new query resolver using <a href="https://github.com/graphql/graphiql" target="_blank" rel="external">GraphiQL</a>, but first we need some data. Create a new <code>seed.js</code> file inside <code>server</code>:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Movies <span class="keyword">from</span> <span class="string">'../modules/movies/collection.js'</span>;</span><br><span class="line"><span class="keyword">import</span> Users <span class="keyword">from</span> <span class="string">'meteor/vulcan:users'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; newMutation &#125; <span class="keyword">from</span> <span class="string">'meteor/vulcan:core'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> seedData = [</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">'Star Wars'</span>,</span><br><span class="line">    <span class="attr">year</span>: <span class="string">'1973'</span>,</span><br><span class="line">    <span class="attr">review</span>: <span class="string">`A classic.`</span>,</span><br><span class="line">    <span class="attr">privateComments</span>: <span class="string">`Actually, I don't really like Star Wars…`</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">'Die Hard'</span>,</span><br><span class="line">    <span class="attr">year</span>: <span class="string">'1987'</span>,</span><br><span class="line">    <span class="attr">review</span>: <span class="string">`A must-see if you like action movies.`</span>,</span><br><span class="line">    <span class="attr">privateComments</span>: <span class="string">`I love Bruce Willis so much!`</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">'Terminator'</span>,</span><br><span class="line">    <span class="attr">year</span>: <span class="string">'1983'</span>,</span><br><span class="line">    <span class="attr">review</span>: <span class="string">`Once again, Schwarzenegger shows why he's the boss.`</span>,</span><br><span class="line">    <span class="attr">privateComments</span>: <span class="string">`Terminator is my favorite movie ever. `</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">'Jaws'</span>,</span><br><span class="line">    <span class="attr">year</span>: <span class="string">'1971'</span>,</span><br><span class="line">    <span class="attr">review</span>: <span class="string">'The original blockbuster.'</span>,</span><br><span class="line">    <span class="attr">privateComments</span>: <span class="string">`I'm scared of sharks…`</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">'Die Hard II'</span>,</span><br><span class="line">    <span class="attr">year</span>: <span class="string">'1991'</span>,</span><br><span class="line">    <span class="attr">review</span>: <span class="string">`Another classic.`</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">'Rush Hour'</span>,</span><br><span class="line">    <span class="attr">year</span>: <span class="string">'1993'</span>,</span><br><span class="line">    <span class="attr">review</span>: <span class="string">`Jackie Chan at his best.`</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">'Citizen Kane'</span>,</span><br><span class="line">    <span class="attr">year</span>: <span class="string">'1943'</span>,</span><br><span class="line">    <span class="attr">review</span>: <span class="string">`A disappointing lack of action sequences.`</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">'Commando'</span>,</span><br><span class="line">    <span class="attr">year</span>: <span class="string">'1983'</span>,</span><br><span class="line">    <span class="attr">review</span>: <span class="string">'A good contender for highest kill count ever.'</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line">Meteor.startup(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (Users.find().fetch().length === <span class="number">0</span>) &#123;</span><br><span class="line">    Accounts.createUser(&#123;</span><br><span class="line">      <span class="attr">username</span>: <span class="string">'DemoUser'</span>,</span><br><span class="line">      <span class="attr">email</span>: <span class="string">'dummyuser@telescopeapp.org'</span>,</span><br><span class="line">      <span class="attr">profile</span>: &#123;</span><br><span class="line">        <span class="attr">isDummy</span>: <span class="literal">true</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> currentUser = Users.findOne();</span><br><span class="line">  <span class="keyword">if</span> (Movies.find().fetch().length === <span class="number">0</span>) &#123;</span><br><span class="line">    seedData.forEach(<span class="function"><span class="params">document</span> =&gt;</span> &#123;</span><br><span class="line">      newMutation(&#123;</span><br><span class="line">        <span class="attr">action</span>: <span class="string">'movies.new'</span>,</span><br><span class="line">        <span class="attr">collection</span>: Movies,</span><br><span class="line">        <span class="attr">document</span>: <span class="built_in">document</span>, </span><br><span class="line">        <span class="attr">currentUser</span>: currentUser,</span><br><span class="line">        <span class="attr">validate</span>: <span class="literal">false</span></span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>This time, we don’t want to import this on the client, so we’ll import it directly from our <code>server/main.js</code> endpoint:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">'../modules/index.js'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'./seed.js'</span>;</span><br></pre></td></tr></table></figure>
<p>Head to <a href="http://localhost:3000/graphiql" target="_blank" rel="external">http://localhost:3000/graphiql</a> and type:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">query moviesQuery&#123;</span><br><span class="line">  moviesList&#123;</span><br><span class="line">    createdAt</span><br><span class="line">    name</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>You should get a list of movie names and creation dates on the right. If you’d like, try requesting more fields:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">query moviesQuery&#123;</span><br><span class="line">  moviesList&#123;</span><br><span class="line">    createdAt</span><br><span class="line">    name</span><br><span class="line">    review</span><br><span class="line">    year</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>As you can see, the great thing about GraphQL is that you can specify exactly which piece of data you need!</p>
<h2 id="More-Advanced-Resolvers"><a href="#More-Advanced-Resolvers" class="headerlink" title="More Advanced Resolvers*"></a>More Advanced Resolvers*</h2><p><em>(Note: you can skip this section if you’re using default resolvers and mutations)</em></p>
<p>Although our resolver works, it’s fairly limited. As it stands, we can’t filter, sort, or paginate our data. Even though we might not need these features right away, now is a good time to set things up in a more future-proof way.</p>
<p>Our resolver will accept a <a href="terms-parameters.html">terms</a> object that can specify filtering and sorting options, which is then transformed into a MongoDB-compatible object by the <code>Movies.getParameters()</code> function. Additionally, we’ll add a second resolver that takes in the same <code>terms</code>, but returns the <em>number</em> of documents matching these terms:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> resolvers = &#123;</span><br><span class="line"></span><br><span class="line">  <span class="attr">list</span>: &#123;</span><br><span class="line"></span><br><span class="line">    <span class="attr">name</span>: <span class="string">'moviesList'</span>,</span><br><span class="line"></span><br><span class="line">    resolver(root, &#123;terms = &#123;&#125;&#125;, context, info) &#123;</span><br><span class="line">      <span class="keyword">const</span> &#123;selector, options&#125; = context.Movies.getParameters(terms, &#123;&#125;, context.currentUser);</span><br><span class="line">      <span class="keyword">return</span> context.Movies.find(selector, options).fetch();</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="attr">total</span>: &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="attr">name</span>: <span class="string">'moviesTotal'</span>,</span><br><span class="line">    </span><br><span class="line">    resolver(root, &#123;terms = &#123;&#125;&#125;, context) &#123;</span><br><span class="line">      <span class="keyword">const</span> &#123;selector, options&#125; = context.Movies.getParameters(terms, &#123;&#125;, context.currentUser);</span><br><span class="line">      <span class="keyword">return</span> context.Movies.find(selector, options).count();</span><br><span class="line">    &#125;,</span><br><span class="line">  </span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> resolvers;</span><br></pre></td></tr></table></figure>
<p>Our resolvers take three arguments:</p>
<ul>
<li><code>root</code>: a link back to the root of the current GraphQL node. You can safely ignore this for now. </li>
<li><code>args</code>: an object containing the query arguments passed from the client.</li>
<li><code>context</code>: an object enabling access to our collections, as well as utilities such as <code>getViewableFields</code> (which is used to get a list of all fields viewable for the current user for a given collection). </li>
</ul>
<p>Once we’ve figured out the correct <code>selector</code> and <code>options</code> object from the <code>terms</code> and the current user, all that’s left is to make the actual database query using <code>Movies.find()</code>. </p>
<h2 id="The-User-Resolver"><a href="#The-User-Resolver" class="headerlink" title="The User Resolver"></a>The User Resolver</h2><p>If you inspect the collection schema for a movie, you’ll notice it contains a <code>userId</code> field that contains a string. </p>
<p>But that string, while useful internally, isn’t much use to our app’s users. Instead, we’d much rather display the reviewer’s name. In order to do so, we’ll <strong>resolver</strong> the <code>userId</code> field as a <code>user</code> object containing all the data we need. </p>
<p>Go back to your <code>schema.js</code> file, and add the following <code>resolveAs</code> property to the <code>userId</code> field:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">userId: &#123;</span><br><span class="line">  <span class="attr">type</span>: <span class="built_in">String</span>,</span><br><span class="line">  <span class="attr">optional</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">viewableBy</span>: [<span class="string">'guests'</span>],</span><br><span class="line">  <span class="attr">resolveAs</span>: &#123;</span><br><span class="line">    <span class="attr">fieldName</span>: <span class="string">'user'</span>,</span><br><span class="line">    <span class="attr">type</span>: <span class="string">'User'</span>,</span><br><span class="line">    <span class="attr">resolver</span>: <span class="function">(<span class="params">movie, args, context</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> context.Users.findOne(&#123; <span class="attr">_id</span>: movie.userId &#125;, &#123; <span class="attr">fields</span>: context.Users.getViewableFields(context.currentUser, context.Users) &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">addOriginalField</span>: <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<p>We are doing four things here:</p>
<ol>
<li>Specifying that the field should be named <code>user</code> in the API.</li>
<li>Specifying that the <code>user</code> field returns an object of GraphQL type <code>User</code>.</li>
<li>Defining a <code>resolver</code> function that indicates how to retrieve that object.</li>
<li>Specifying that in addition to this new <code>user</code> object, we want the original <code>userId</code> field to still be available as well. </li>
</ol>
<h2 id="Displaying-Data"><a href="#Displaying-Data" class="headerlink" title="Displaying Data"></a>Displaying Data</h2><p>Now that we know we can access data from the client, let’s see how to actually load and display it within our app. </p>
<p>We’ll need two pieces for this: a <a href="https://medium.com/@dan_abramov/smart-and-dumb-components-7ca2f9a7c7d0#.uid3w3pk8" target="_blank" rel="external"><strong>container</strong> component</a> that loads the data, and a <strong>presentational</strong> component that displays it. Fortunately, Vulcan comes with <a href="data-loading.html">a set of built-in higher-order container components</a> which we can use out of the box, so we can focus on the presentational components.</p>
<p>Create a new <code>MoviesItem</code> component inside <code>components</code>:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">import React, &#123; PropTypes, Component &#125; from 'react';</span><br><span class="line">import &#123; registerComponent, ModalTrigger &#125; from 'meteor/vulcan:core';</span><br><span class="line"></span><br><span class="line">const MoviesItem = (&#123;movie, currentUser&#125;) =&gt;</span><br><span class="line"></span><br><span class="line">  &lt;div style=&#123; &#123; paddingBottom: "15px",marginBottom: "15px", borderBottom: "1px solid #ccc" &#125; &#125;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;h4&gt;&#123;movie.name&#125; (&#123;movie.year&#125;)&lt;/h4&gt;</span><br><span class="line">    &lt;p&gt;&#123;movie.review&#125; – &#123;movie.user &amp;&amp; movie.user.displayName&#125;&lt;/p&gt;</span><br><span class="line"></span><br><span class="line">  &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">export default MoviesItem;</span><br></pre></td></tr></table></figure>
<p>We’ll also come back to the <code>MoviesList</code> component and use a <a href="fragments.html">GraphQL fragment</a> (which we’ll define in the next section) to specify what data we want to load using the <code>withList</code> <a href="https://facebook.github.io/react/docs/higher-order-components.html" target="_blank" rel="external">higher-order component</a>: </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; PropTypes, Component &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Components, withList, withCurrentUser, Loading &#125; <span class="keyword">from</span> <span class="string">'meteor/vulcan:core'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> Movies <span class="keyword">from</span> <span class="string">'../../modules/movies/collection.js'</span>;</span><br><span class="line"><span class="keyword">import</span> MoviesItem <span class="keyword">from</span> <span class="string">'./MoviesItem.jsx'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> MoviesList = <span class="function">(<span class="params">&#123;results = [], currentUser, loading, loadMore, count, totalCount&#125;</span>) =&gt;</span> </span><br><span class="line">  </span><br><span class="line">  &lt;div style=&#123; &#123; <span class="attr">maxWidth</span>: <span class="string">'500px'</span>, <span class="attr">margin</span>: <span class="string">'20px auto'</span> &#125; &#125;&gt;</span><br><span class="line"></span><br><span class="line">    &#123;<span class="comment">/* user accounts placeholder*/</span>&#125;</span><br><span class="line"></span><br><span class="line">    &#123;loading ? </span><br><span class="line"></span><br><span class="line">      <span class="xml"><span class="tag">&lt;<span class="name">Loading</span> /&gt;</span> :</span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">"movies"</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">        &#123;/* new document form placeholder */&#125;</span><br><span class="line"></span><br><span class="line">        &#123;/* documents list */&#125;</span><br><span class="line"></span><br><span class="line">        &#123;results.map(movie =&gt; <span class="tag">&lt;<span class="name">MoviesItem</span> <span class="attr">key</span>=<span class="string">&#123;movie._id&#125;</span> <span class="attr">movie</span>=<span class="string">&#123;movie&#125;</span> <span class="attr">currentUser</span>=<span class="string">&#123;currentUser&#125;</span> /&gt;</span>)&#125;</span><br><span class="line">        </span><br><span class="line">        &#123;/* load more */&#125;</span><br><span class="line"></span><br><span class="line">        &#123;totalCount &gt; results.length ?</span><br><span class="line">          <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#"</span> <span class="attr">onClick</span>=<span class="string">&#123;e</span> =&gt;</span> &#123;e.preventDefault(); loadMore();&#125;&#125;&gt;Load More (&#123;count&#125;/&#123;totalCount&#125;)<span class="tag">&lt;/<span class="name">a</span>&gt;</span> : </span><br><span class="line">          <span class="tag">&lt;<span class="name">p</span>&gt;</span>No more items.<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">const options = &#123;</span><br><span class="line">  collection: Movies,</span><br><span class="line">  fragmentName: 'MoviesItemFragment',</span><br><span class="line">  limit: 5</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">export default withList(options)(withCurrentUser(MoviesList))</span></span><br></pre></td></tr></table></figure>
<p>We want to provide <code>MoviesList</code> with the <code>results</code> document list and the <code>currentUser</code> property, so we wrap it with <code>withList</code> and <code>withCurrentUser</code>.</p>
<h2 id="Fragments"><a href="#Fragments" class="headerlink" title="Fragments"></a>Fragments</h2><p>At this stage, we’ll probably get an error message saying the fragment we’re using is not yet defined. To remedy this, create a new <code>fragments.js</code> file inside <code>modules/movies</code>:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; registerFragment &#125; <span class="keyword">from</span> <span class="string">'meteor/vulcan:core'</span>;</span><br><span class="line"></span><br><span class="line">registerFragment(<span class="string">`</span><br><span class="line">  fragment MoviesItemFragment on Movie &#123;</span><br><span class="line">    _id</span><br><span class="line">    createdAt</span><br><span class="line">    userId</span><br><span class="line">    user &#123;</span><br><span class="line">      displayName</span><br><span class="line">    &#125;</span><br><span class="line">    name</span><br><span class="line">    year</span><br><span class="line">    review</span><br><span class="line">  &#125;</span><br><span class="line">`</span>);</span><br></pre></td></tr></table></figure>
<p>And don’t forget to import it within <code>collection.js</code>:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createCollection &#125; <span class="keyword">from</span> <span class="string">'meteor/vulcan:core'</span>;</span><br><span class="line"><span class="keyword">import</span> schema <span class="keyword">from</span> <span class="string">'./schema.js'</span>;</span><br><span class="line"><span class="keyword">import</span> resolvers <span class="keyword">from</span> <span class="string">'./resolvers.js'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'./fragments.js'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//...</span></span><br></pre></td></tr></table></figure>
<p>Once you save, you should finally get your prize: a shiny new movie list displayed right there on your screen!</p>
<h2 id="User-Accounts"><a href="#User-Accounts" class="headerlink" title="User Accounts"></a>User Accounts</h2><p>So far so good, but we can’t yet do a lot with our app. In order to give it a little more potential, let’s add user accounts to <code>MoviesList</code>: </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; PropTypes, Component &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Components, withList, withCurrentUser, Loading &#125; <span class="keyword">from</span> <span class="string">'meteor/vulcan:core'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> Movies <span class="keyword">from</span> <span class="string">'../../modules/movies/collection.js'</span>;</span><br><span class="line"><span class="keyword">import</span> MoviesItem <span class="keyword">from</span> <span class="string">'./MoviesItem.jsx'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> MoviesList = <span class="function">(<span class="params">&#123;results = [], currentUser, loading, loadMore, count, totalCount&#125;</span>) =&gt;</span> </span><br><span class="line">  </span><br><span class="line">  &lt;div style=&#123; &#123; <span class="attr">maxWidth</span>: <span class="string">'500px'</span>, <span class="attr">margin</span>: <span class="string">'20px auto'</span> &#125; &#125;&gt;</span><br><span class="line"></span><br><span class="line">    &#123;<span class="comment">/* user accounts */</span>&#125;</span><br><span class="line"></span><br><span class="line">    &lt;div style=&#123; &#123; <span class="attr">padding</span>: <span class="string">'20px 0'</span>, <span class="attr">marginBottom</span>: <span class="string">'20px'</span>, <span class="attr">borderBottom</span>: <span class="string">'1px solid #ccc'</span> &#125; &#125;&gt;</span><br><span class="line">    </span><br><span class="line">      <span class="xml"><span class="tag">&lt;<span class="name">Components.AccountsLoginForm</span> /&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line">    &#123;loading ? </span><br><span class="line"></span><br><span class="line">      <span class="xml"><span class="tag">&lt;<span class="name">Loading</span> /&gt;</span> :</span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">"movies"</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">        &#123;/* new document form placeholder */&#125;</span><br><span class="line"></span><br><span class="line">        &#123;/* documents list */&#125;</span><br><span class="line"></span><br><span class="line">        &#123;results.map(movie =&gt; <span class="tag">&lt;<span class="name">MoviesItem</span> <span class="attr">key</span>=<span class="string">&#123;movie._id&#125;</span> <span class="attr">movie</span>=<span class="string">&#123;movie&#125;</span> <span class="attr">currentUser</span>=<span class="string">&#123;currentUser&#125;</span> /&gt;</span>)&#125;</span><br><span class="line">        </span><br><span class="line">        &#123;/* load more */&#125;</span><br><span class="line"></span><br><span class="line">        &#123;totalCount &gt; results.length ?</span><br><span class="line">          <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#"</span> <span class="attr">onClick</span>=<span class="string">&#123;e</span> =&gt;</span> &#123;e.preventDefault(); loadMore();&#125;&#125;&gt;Load More (&#123;count&#125;/&#123;totalCount&#125;)<span class="tag">&lt;/<span class="name">a</span>&gt;</span> : </span><br><span class="line">          <span class="tag">&lt;<span class="name">p</span>&gt;</span>No more items.<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">const options = &#123;</span><br><span class="line">  collection: Movies,</span><br><span class="line">  fragmentName: 'MoviesItemFragment',</span><br><span class="line">  limit: 5</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">export default withList(options)(withCurrentUser(MoviesList));</span></span><br></pre></td></tr></table></figure>
<p>Yay! You can now log in and sign up at your own leisure. Note that the <code>&lt;Components.AccountsLoginForm /&gt;</code> component is a ready-made accounts UI component that comes from the <code>vulcan:accounts</code> package. </p>
<h2 id="Mutations"><a href="#Mutations" class="headerlink" title="Mutations*"></a>Mutations*</h2><p><em>(Note: you can skip this section if you’re using default resolvers and mutations)</em></p>
<p>Now that we’re logged in, we can start interacting with our data. Let’s build a simple form for adding new movies.</p>
<p>Before we can build the user-facing part of this feature though, we need to think about how the insertion will be handled server-side, using <a href="mutations.html">Mutations</a>.</p>
<p>Create a new <code>mutations.js</code> file in <code>modules/movies</code>:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; newMutation, Utils &#125; <span class="keyword">from</span> <span class="string">'meteor/vulcan:core'</span>;</span><br><span class="line"><span class="keyword">import</span> Users <span class="keyword">from</span> <span class="string">'meteor/vulcan:users'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> mutations = &#123;</span><br><span class="line"></span><br><span class="line">  <span class="attr">new</span>: &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="attr">name</span>: <span class="string">'moviesNew'</span>,</span><br><span class="line">    </span><br><span class="line">    check(user) &#123;</span><br><span class="line">      <span class="keyword">if</span> (!user) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">      <span class="keyword">return</span> Users.canDo(user, <span class="string">'movies.new'</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">    </span><br><span class="line">    mutation(root, &#123;<span class="built_in">document</span>&#125;, context) &#123;</span><br><span class="line">      </span><br><span class="line">      Utils.performCheck(<span class="keyword">this</span>.check, context.currentUser, <span class="built_in">document</span>);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> newMutation(&#123;</span><br><span class="line">        <span class="attr">collection</span>: context.Movies,</span><br><span class="line">        <span class="attr">document</span>: <span class="built_in">document</span>, </span><br><span class="line">        <span class="attr">currentUser</span>: context.currentUser,</span><br><span class="line">        <span class="attr">validate</span>: <span class="literal">true</span>,</span><br><span class="line">        context,</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> mutations;</span><br></pre></td></tr></table></figure>
<p>This mutation performs a simple check for the presence of a logged-in user and whether they can perform the action, and then passes on the <code>document</code> property to one of Vulcan’s boilerplate mutations, <code>newMutation</code>. </p>
<p>Let’s pass it on to our <code>createCollection</code> function in <code>collection.js</code>:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createCollection &#125; <span class="keyword">from</span> <span class="string">'meteor/vulcan:core'</span>;</span><br><span class="line"><span class="keyword">import</span> schema <span class="keyword">from</span> <span class="string">'./schema.js'</span>;</span><br><span class="line"><span class="keyword">import</span> resolvers <span class="keyword">from</span> <span class="string">'./resolvers.js'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'./fragments.js'</span>;</span><br><span class="line"><span class="keyword">import</span> mutations <span class="keyword">from</span> <span class="string">'./mutations.js'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Movies = createCollection(&#123;</span><br><span class="line"></span><br><span class="line">  <span class="attr">collectionName</span>: <span class="string">'Movies'</span>,</span><br><span class="line"></span><br><span class="line">  <span class="attr">typeName</span>: <span class="string">'Movie'</span>,</span><br><span class="line"></span><br><span class="line">  schema,</span><br><span class="line">  </span><br><span class="line">  resolvers,</span><br><span class="line"></span><br><span class="line">  mutations,</span><br><span class="line"></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Movies;</span><br></pre></td></tr></table></figure>
<h2 id="Actions-Groups-amp-Permissions"><a href="#Actions-Groups-amp-Permissions" class="headerlink" title="Actions, Groups, &amp; Permissions"></a>Actions, Groups, &amp; Permissions</h2><p>The mutation’s <code>check</code> function checks if the user can perform an action named <code>movies.new</code>. We want all logged-in users (known as the <code>members</code> group) to be able to perform this action, so let’s take care of this by creating a new <code>movies/permissions.js</code> file:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Users <span class="keyword">from</span> <span class="string">'meteor/vulcan:users'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> membersActions = [</span><br><span class="line">  <span class="string">'movies.new'</span>,</span><br><span class="line">];</span><br><span class="line">Users.groups.members.can(membersActions);</span><br></pre></td></tr></table></figure>
<p>And adding it to <code>collection.js</code> as usual:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createCollection &#125; <span class="keyword">from</span> <span class="string">'meteor/vulcan:core'</span>;</span><br><span class="line"><span class="keyword">import</span> schema <span class="keyword">from</span> <span class="string">'./schema.js'</span>;</span><br><span class="line"><span class="keyword">import</span> resolvers <span class="keyword">from</span> <span class="string">'./resolvers.js'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'./fragments.js'</span>;</span><br><span class="line"><span class="keyword">import</span> mutations <span class="keyword">from</span> <span class="string">'./mutations.js'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'./permissions.js'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//...</span></span><br></pre></td></tr></table></figure>
<p>Note that in this specific case, creating an action and checking for it is a bit superfluous, as it boils down to checking if the user is logged in. But this is a good introduction to the permission patterns used in Vulcan, which you can learn more about in the <a href="/groups-permissions.html">Groups &amp; Permissions</a> section.</p>
<p>One more thing! By default, all schema fields are locked down, so we need to specify which ones the user should be able to insert as part of a “new document” operation. </p>
<p>Once again, we do this through the schema. We’ll add an <code>insertableBy</code> property to any “insertable” field and set it to <code>[members]</code> to indicate that a field should be insertable by any member of the <code>members</code> group (in other words, regular logged-in users):</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> schema = &#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// default properties</span></span><br><span class="line"></span><br><span class="line">  _id: &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="built_in">String</span>,</span><br><span class="line">    <span class="attr">optional</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">viewableBy</span>: [<span class="string">'guests'</span>],</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">createdAt</span>: &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="built_in">Date</span>,</span><br><span class="line">    <span class="attr">optional</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">viewableBy</span>: [<span class="string">'guests'</span>],</span><br><span class="line">    <span class="attr">onInsert</span>: <span class="function">(<span class="params"><span class="built_in">document</span>, currentUser</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">userId</span>: &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="built_in">String</span>,</span><br><span class="line">    <span class="attr">optional</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">viewableBy</span>: [<span class="string">'guests'</span>],</span><br><span class="line">    <span class="attr">resolveAs</span>: &#123;</span><br><span class="line">      <span class="attr">fieldName</span>: <span class="string">'user'</span>,</span><br><span class="line">      <span class="attr">type</span>: <span class="string">'User'</span>,</span><br><span class="line">      <span class="attr">resolver</span>: <span class="function">(<span class="params">movie, args, context</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> context.Users.findOne(&#123; <span class="attr">_id</span>: movie.userId &#125;, &#123; <span class="attr">fields</span>: context.Users.getViewableFields(context.currentUser, context.Users) &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// custom properties</span></span><br><span class="line"></span><br><span class="line">  name: &#123;</span><br><span class="line">    <span class="attr">label</span>: <span class="string">'Name'</span>,</span><br><span class="line">    <span class="attr">type</span>: <span class="built_in">String</span>,</span><br><span class="line">    <span class="attr">optional</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">viewableBy</span>: [<span class="string">'guests'</span>],</span><br><span class="line">    <span class="attr">insertableBy</span>: [<span class="string">'members'</span>],</span><br><span class="line">    <span class="attr">editableBy</span>: [<span class="string">'members'</span>],</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">year</span>: &#123;</span><br><span class="line">    <span class="attr">label</span>: <span class="string">'Year'</span>,</span><br><span class="line">    <span class="attr">type</span>: <span class="built_in">String</span>,</span><br><span class="line">    <span class="attr">optional</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">viewableBy</span>: [<span class="string">'guests'</span>],</span><br><span class="line">    <span class="attr">insertableBy</span>: [<span class="string">'members'</span>],</span><br><span class="line">    <span class="attr">editableBy</span>: [<span class="string">'members'</span>],</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">review</span>: &#123;</span><br><span class="line">    <span class="attr">label</span>: <span class="string">'Review'</span>,</span><br><span class="line">    <span class="attr">type</span>: <span class="built_in">String</span>,</span><br><span class="line">    <span class="attr">optional</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">control</span>: <span class="string">'textarea'</span>,</span><br><span class="line">    <span class="attr">viewableBy</span>: [<span class="string">'guests'</span>],</span><br><span class="line">    <span class="attr">insertableBy</span>: [<span class="string">'members'</span>],</span><br><span class="line">    <span class="attr">editableBy</span>: [<span class="string">'members'</span>]</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> schema;</span><br></pre></td></tr></table></figure>
<p>While we’re at it we’ll also specify which fields can be edited via <code>editableBy</code>. In this case, the three fields we want members to be able to write to are <code>name</code>, <code>year</code>, and <code>review</code>. Finally, we’ll also give the <code>review</code> field a <code>textarea</code> form control. </p>
<p>At this point it’s worth pointing out that for mutations like inserting and editing a document, we have two distinct permission “checkpoints”: first, the mutation’s <code>check</code> function checks if the user can perform the mutation at all. Then, each of the mutated document’s fields is checked individually to see if the user should be able to mutate it.</p>
<p>This makes it easy to set up collections with admin-only fields, for example. </p>
<h2 id="Forms"><a href="#Forms" class="headerlink" title="Forms"></a>Forms</h2><p>We now have everything we need to create a new <code>MoviesNewForm.jsx</code> component using the <a href="/forms.html">SmartForm</a> utility:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; PropTypes, Component &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Components, registerComponent, withCurrentUser, getFragment &#125; <span class="keyword">from</span> <span class="string">'meteor/vulcan:core'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> Movies <span class="keyword">from</span> <span class="string">'../../modules/movies/collection.js'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> MoviesNewForm = <span class="function">(<span class="params">&#123;currentUser&#125;</span>) =&gt;</span></span><br><span class="line"></span><br><span class="line">  &lt;div&gt;</span><br><span class="line"></span><br><span class="line">    &#123;Movies.options.mutations.new.check(currentUser) ?</span><br><span class="line">      <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&#123;</span> &#123; <span class="attr">marginBottom:</span> '<span class="attr">20px</span>', <span class="attr">paddingBottom:</span> '<span class="attr">20px</span>', <span class="attr">borderBottom:</span> '<span class="attr">1px</span> <span class="attr">solid</span> #<span class="attr">ccc</span>' &#125; &#125;&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h4</span>&gt;</span>Insert New Document<span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Components.SmartForm</span> </span><br><span class="line">          <span class="attr">collection</span>=<span class="string">&#123;Movies&#125;</span></span><br><span class="line">          <span class="attr">mutationFragment</span>=<span class="string">&#123;getFragment(</span>'<span class="attr">MoviesItemFragment</span>')&#125;</span><br><span class="line">        /&gt;</span> </span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span> :</span><br><span class="line">      null</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> withCurrentUser(MoviesNewForm);</span><br></pre></td></tr></table></figure>
<p>A few things to note: </p>
<ul>
<li>We’ll pass the <code>MoviesItemFragment</code> fragment to the form so that it knows what data to return from the server once the mutation is complete. </li>
<li>We only want to show the “New Movie” form when a user actually <em>can</em> submit a new movie, so we’ll make use of the <code>new</code> mutation’s <code>check</code> function to figure this out.</li>
<li>We need to access the current user to perform this check, so we’ll use the <code>withCurrentUser</code> higher-order component. </li>
</ul>
<p>Let’s import the form component from <code>MoviesList.jsx</code>:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; PropTypes, Component &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Components, withList, withCurrentUser, Loading &#125; <span class="keyword">from</span> <span class="string">'meteor/vulcan:core'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> Movies <span class="keyword">from</span> <span class="string">'../../modules/movies/collection.js'</span>;</span><br><span class="line"><span class="keyword">import</span> MoviesItem <span class="keyword">from</span> <span class="string">'./MoviesItem.jsx'</span>;</span><br><span class="line"><span class="keyword">import</span> MoviesNewForm <span class="keyword">from</span> <span class="string">'./MoviesNewForm.jsx'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> MoviesList = <span class="function">(<span class="params">&#123;results = [], currentUser, loading, loadMore, count, totalCount&#125;</span>) =&gt;</span> </span><br><span class="line">  </span><br><span class="line">  &lt;div style=&#123; &#123; <span class="attr">maxWidth</span>: <span class="string">'500px'</span>, <span class="attr">margin</span>: <span class="string">'20px auto'</span> &#125; &#125;&gt;</span><br><span class="line"></span><br><span class="line">    &#123;<span class="comment">/* user accounts */</span>&#125;</span><br><span class="line"></span><br><span class="line">    &lt;div style=&#123; &#123; <span class="attr">padding</span>: <span class="string">'20px 0'</span>, <span class="attr">marginBottom</span>: <span class="string">'20px'</span>, <span class="attr">borderBottom</span>: <span class="string">'1px solid #ccc'</span> &#125; &#125;&gt;</span><br><span class="line">    </span><br><span class="line">      <span class="xml"><span class="tag">&lt;<span class="name">Components.AccountsLoginForm</span> /&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line">    &#123;loading ? </span><br><span class="line"></span><br><span class="line">      <span class="xml"><span class="tag">&lt;<span class="name">Loading</span> /&gt;</span> :</span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">"movies"</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">        &#123;/* new document form */&#125;</span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">MoviesNewForm</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">        &#123;/* documents list */&#125;</span><br><span class="line"></span><br><span class="line">        &#123;results.map(movie =&gt; <span class="tag">&lt;<span class="name">MoviesItem</span> <span class="attr">key</span>=<span class="string">&#123;movie._id&#125;</span> <span class="attr">movie</span>=<span class="string">&#123;movie&#125;</span> <span class="attr">currentUser</span>=<span class="string">&#123;currentUser&#125;</span> /&gt;</span>)&#125;</span><br><span class="line">        </span><br><span class="line">        &#123;/* load more */&#125;</span><br><span class="line"></span><br><span class="line">        &#123;totalCount &gt; results.length ?</span><br><span class="line">          <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#"</span> <span class="attr">onClick</span>=<span class="string">&#123;e</span> =&gt;</span> &#123;e.preventDefault(); loadMore();&#125;&#125;&gt;Load More (&#123;count&#125;/&#123;totalCount&#125;)<span class="tag">&lt;/<span class="name">a</span>&gt;</span> : </span><br><span class="line">          <span class="tag">&lt;<span class="name">p</span>&gt;</span>No more items.<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">const options = &#123;</span><br><span class="line">  collection: Movies,</span><br><span class="line">  fragmentName: 'MoviesItemFragment',</span><br><span class="line">  limit: 5</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">export default withList(options)(withCurrentUser(MoviesList));</span></span><br></pre></td></tr></table></figure>
<p>Now fill out the form and submit it. The query will be updated and the new movie will appear right there in our list! </p>
<h2 id="Editing-Movies"><a href="#Editing-Movies" class="headerlink" title="Editing Movies"></a>Editing Movies</h2><p>We’re almost done! All we need now is to add a way to edit movies. First, create a new <code>MoviesEditForm.jsx</code> component:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; PropTypes, Component &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Components, registerComponent, getFragment &#125; <span class="keyword">from</span> <span class="string">"meteor/vulcan:core"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> Movies <span class="keyword">from</span> <span class="string">'../../modules/movies/collection.js'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> MoviesEditForm = <span class="function">(<span class="params">&#123;documentId, closeModal&#125;</span>) =&gt;</span></span><br><span class="line"></span><br><span class="line">  &lt;Components.SmartForm </span><br><span class="line">    collection=&#123;Movies&#125;</span><br><span class="line">    documentId=&#123;documentId&#125;</span><br><span class="line">    mutationFragment=&#123;getFragment(<span class="string">'MoviesItemFragment'</span>)&#125;</span><br><span class="line">    showRemove=&#123;<span class="literal">true</span>&#125;</span><br><span class="line">    successCallback=&#123;<span class="built_in">document</span> =&gt; &#123;</span><br><span class="line">      closeModal();</span><br><span class="line">    &#125;&#125;</span><br><span class="line">  /&gt;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> MoviesEditForm;</span><br></pre></td></tr></table></figure>
<p>Because we’re passing a specific <code>documentId</code> property to the <code>SmartForm</code> component, this form will be an <strong>edit document</strong> form. We’re also passing <code>showRemove</code> to show a “delete document” option, and a <code>successCallback</code> function to close the modal popup inside which the form will be displayed. </p>
<p>But note that to <em>edit</em> a document, we first need to know what that document <em>is</em>. In other words, we need to load the document on the client. SmartForms can take care of this for us, but we do need to write a new resolver. After all, the one we have displays a <em>list</em> of document, not a <em>single</em> document. </p>
<p>Go back to <code>resolvers.js</code> and add a <code>single</code> resolver:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> resolvers = &#123;</span><br><span class="line"></span><br><span class="line">  <span class="attr">list</span>: &#123;</span><br><span class="line"></span><br><span class="line">    <span class="attr">name</span>: <span class="string">'moviesList'</span>,</span><br><span class="line"></span><br><span class="line">    resolver(root, &#123;terms = &#123;&#125;&#125;, context, info) &#123;</span><br><span class="line">      <span class="keyword">const</span> &#123;selector, options&#125; = context.Movies.getParameters(terms, &#123;&#125;, context.currentUser);</span><br><span class="line">      <span class="keyword">return</span> context.Movies.find(selector, options).fetch();</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="attr">single</span>: &#123;</span><br><span class="line"></span><br><span class="line">    <span class="attr">name</span>: <span class="string">'moviesSingle'</span>,</span><br><span class="line"></span><br><span class="line">    resolver(root, &#123;documentId&#125;, context) &#123;</span><br><span class="line">      <span class="keyword">return</span> context.Movies.findOne(documentId);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="attr">total</span>: &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="attr">name</span>: <span class="string">'moviesTotal'</span>,</span><br><span class="line">    </span><br><span class="line">    resolver(root, &#123;terms = &#123;&#125;&#125;, context) &#123;</span><br><span class="line">      <span class="keyword">const</span> &#123;selector, options&#125; = context.Movies.getParameters(terms, &#123;&#125;, context.currentUser);</span><br><span class="line">      <span class="keyword">return</span> context.Movies.find(selector, options).count();</span><br><span class="line">    &#125;,</span><br><span class="line">  </span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> resolvers;</span><br></pre></td></tr></table></figure>
<p>Now let’s go back to <code>MoviesItem</code> and make use of our form:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">import React, &#123; PropTypes, Component &#125; from 'react';</span><br><span class="line">import &#123; Components, registerComponent &#125; from 'meteor/vulcan:core';</span><br><span class="line"></span><br><span class="line">import Movies from '../../modules/movies/collection.js';</span><br><span class="line">import MoviesEditForm from './MoviesEditForm.jsx';</span><br><span class="line"></span><br><span class="line">const MoviesItem = (&#123;movie, currentUser&#125;) =&gt;</span><br><span class="line"></span><br><span class="line">  &lt;div style=&#123; &#123; paddingBottom: "15px",marginBottom: "15px", borderBottom: "1px solid #ccc" &#125; &#125;&gt;</span><br><span class="line"></span><br><span class="line">    &#123;/* document properties */&#125;</span><br><span class="line">    </span><br><span class="line">    &lt;h4&gt;&#123;movie.name&#125; (&#123;movie.year&#125;)&lt;/h4&gt;</span><br><span class="line">    &lt;p&gt;&#123;movie.review&#125; – &#123;movie.user &amp;&amp; movie.user.displayName&#125;&lt;/p&gt;</span><br><span class="line">    </span><br><span class="line">    &#123;/* edit document form */&#125;</span><br><span class="line"></span><br><span class="line">    &#123;Movies.options.mutations.edit.check(currentUser, movie) ? </span><br><span class="line">      &lt;Components.ModalTrigger label="Edit Movie"&gt;</span><br><span class="line">        &lt;MoviesEditForm currentUser=&#123;currentUser&#125; documentId=&#123;movie._id&#125; /&gt;</span><br><span class="line">      &lt;/Components.ModalTrigger&gt;</span><br><span class="line">      : null</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">export default MoviesItem;</span><br></pre></td></tr></table></figure>
<p>This time we’re using the <code>&lt;Components.ModalTrigger /&gt;</code> Vulcan component to show our form inside a popup (assuming the current user can perform an edit, of course).</p>
<p>Finally, we’ll also need to hook up our edit and remove mutations in <code>mutations.js</code>:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; newMutation, editMutation, removeMutation, Utils &#125; <span class="keyword">from</span> <span class="string">'meteor/vulcan:core'</span>;</span><br><span class="line"><span class="keyword">import</span> Users <span class="keyword">from</span> <span class="string">'meteor/vulcan:users'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> mutations = &#123;</span><br><span class="line"></span><br><span class="line">  <span class="attr">new</span>: &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="attr">name</span>: <span class="string">'moviesNew'</span>,</span><br><span class="line">    </span><br><span class="line">    check(user) &#123;</span><br><span class="line">      <span class="keyword">if</span> (!user) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">      <span class="keyword">return</span> Users.canDo(user, <span class="string">'movies.new'</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">    </span><br><span class="line">    mutation(root, &#123;<span class="built_in">document</span>&#125;, context) &#123;</span><br><span class="line">      </span><br><span class="line">      Utils.performCheck(<span class="keyword">this</span>.check, context.currentUser, <span class="built_in">document</span>);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> newMutation(&#123;</span><br><span class="line">        <span class="attr">collection</span>: context.Movies,</span><br><span class="line">        <span class="attr">document</span>: <span class="built_in">document</span>, </span><br><span class="line">        <span class="attr">currentUser</span>: context.currentUser,</span><br><span class="line">        <span class="attr">validate</span>: <span class="literal">true</span>,</span><br><span class="line">        context,</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="attr">edit</span>: &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="attr">name</span>: <span class="string">'moviesEdit'</span>,</span><br><span class="line">    </span><br><span class="line">    check(user, <span class="built_in">document</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (!user || !<span class="built_in">document</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">      <span class="keyword">return</span> Users.owns(user, <span class="built_in">document</span>) ? Users.canDo(user, <span class="string">'movies.edit.own'</span>) : Users.canDo(user, <span class="string">`movies.edit.all`</span>);</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    mutation(root, &#123;documentId, set, unset&#125;, context) &#123;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">const</span> <span class="built_in">document</span> = context.Movies.findOne(documentId);</span><br><span class="line">      Utils.performCheck(<span class="keyword">this</span>.check, context.currentUser, <span class="built_in">document</span>);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> editMutation(&#123;</span><br><span class="line">        <span class="attr">collection</span>: context.Movies, </span><br><span class="line">        <span class="attr">documentId</span>: documentId, </span><br><span class="line">        <span class="attr">set</span>: set, </span><br><span class="line">        <span class="attr">unset</span>: unset, </span><br><span class="line">        <span class="attr">currentUser</span>: context.currentUser,</span><br><span class="line">        <span class="attr">validate</span>: <span class="literal">true</span>,</span><br><span class="line">        context,</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">  &#125;,</span><br><span class="line">  </span><br><span class="line">  <span class="attr">remove</span>: &#123;</span><br><span class="line"></span><br><span class="line">    <span class="attr">name</span>: <span class="string">'moviesRemove'</span>,</span><br><span class="line">    </span><br><span class="line">    check(user, <span class="built_in">document</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (!user || !<span class="built_in">document</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">      <span class="keyword">return</span> Users.owns(user, <span class="built_in">document</span>) ? Users.canDo(user, <span class="string">'movies.remove.own'</span>) : Users.canDo(user, <span class="string">`movies.remove.all`</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">    </span><br><span class="line">    mutation(root, &#123;documentId&#125;, context) &#123;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">const</span> <span class="built_in">document</span> = context.Movies.findOne(documentId);</span><br><span class="line">      Utils.performCheck(<span class="keyword">this</span>.check, context.currentUser, <span class="built_in">document</span>);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> removeMutation(&#123;</span><br><span class="line">        <span class="attr">collection</span>: context.Movies, </span><br><span class="line">        <span class="attr">documentId</span>: documentId, </span><br><span class="line">        <span class="attr">currentUser</span>: context.currentUser,</span><br><span class="line">        <span class="attr">validate</span>: <span class="literal">true</span>,</span><br><span class="line">        context,</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> mutations;</span><br></pre></td></tr></table></figure>
<p>For the <code>check</code> function to work properly we need to update the <code>permissions.js</code> file.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Users <span class="keyword">from</span> <span class="string">'meteor/vulcan:users'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> membersActions = [</span><br><span class="line">  <span class="string">'movies.new'</span>,</span><br><span class="line">  <span class="string">'movies.edit.own'</span>,</span><br><span class="line">  <span class="string">'movies.remove.own'</span>,</span><br><span class="line">];</span><br><span class="line">Users.groups.members.can(membersActions);</span><br></pre></td></tr></table></figure>
<p>All done! You should now be able to edit and remove movies. </p>
<h2 id="Sorting"><a href="#Sorting" class="headerlink" title="Sorting"></a>Sorting</h2><p>As it stands, our movie list isn’t really sorted. What if we wanted to sort it by movie year? In Vulcan, document lists receive their options via a <code>terms</code> object. And whenever that object is processed (whether on the client or server), it goes through a serie of successive callbacks. So if we want to set a default sort, we can do so through one of these callbacks. </p>
<p>Create a <code>parameters.js</code> file (learn more about <a href="terms-parameters.html">terms and parameters here</a>):</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; addCallback &#125; <span class="keyword">from</span> <span class="string">'meteor/vulcan:core'</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sortByYear</span> (<span class="params">parameters, terms</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">selector</span>: parameters.selector, </span><br><span class="line">    <span class="attr">options</span>: &#123;...parameters.options, <span class="attr">sort</span>: &#123;<span class="attr">year</span>: <span class="number">-1</span>&#125;&#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">addCallback(<span class="string">"movies.parameters"</span>, sortByYear);</span><br></pre></td></tr></table></figure>
<p>And add it to <code>movies/collection.js</code>:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createCollection &#125; <span class="keyword">from</span> <span class="string">'meteor/vulcan:core'</span>;</span><br><span class="line"><span class="keyword">import</span> schema <span class="keyword">from</span> <span class="string">'./schema.js'</span>;</span><br><span class="line"><span class="keyword">import</span> resolvers <span class="keyword">from</span> <span class="string">'./resolvers.js'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'./fragments.js'</span>;</span><br><span class="line"><span class="keyword">import</span> mutations <span class="keyword">from</span> <span class="string">'./mutations.js'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'./permissions.js'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'./parameters.js'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//...</span></span><br></pre></td></tr></table></figure>
<p>Note that the list automatically re-sorts as you edit individual documents. This might seem like a simple feature, but it’s one more thing you’d have to implement yourself if you weren’t using Vulcan!</p>
<h2 id="Going-Further"><a href="#Going-Further" class="headerlink" title="Going Further"></a>Going Further</h2><p>This is probably a good place to stop, but you can go further simply by going through the code of the <code>example-instagram</code> package. In it, you’ll see how to create a resolver for single documents so you can load more data for a specific movie, and use permission checks to enforce fine-grained security throughout your app.</p>
<p>And this is just the start. You can do a lot more with Vulcan, Apollo, and React, as you’ll soon see!</p>

    </div>
  </div>

  <div class="pagination">
    <div class="content-wrapper">
      
      
        <a class="link primary prev"
          href="example-simple.html">
          <span class="icon-arrow-left-alt"></span>
          <span class="subtitle-pagination">Previous</span>
          Simple Example
        </a>
      
      
        <a class="link primary next"
          href="example-instagram.html">
          <span class="subtitle-pagination">Next</span>
          Instagram Example
          <span class="icon-arrow-right-alt"></span>
        </a>
      
    </div>
  </div>

  <div class="github">
    <a class="link tertiary " href="https://github.com/vulcanjs/nova-docs/tree/master/source/example-movies.md" target="_blank">
      <span class="icon-github"></span>Edit on GitHub</a>
  </div>

  
</div>

    <script src="/script/smooth-scroll.min.js"></script>
    <script src="/script/main.js"></script>
    <script type="text/javascript" src="//cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script>
    <script type="text/javascript" src="//cdn.jsdelivr.net/fastclick/1.0.6/fastclick.min.js"></script>


    <script>
      
    </script>
  </body>
</html>
